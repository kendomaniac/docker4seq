<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>NA • docker4seq</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="NA"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">docker4seq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>NA</h1>
    </div>


<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h2>
<p>The docker4seq package was developed to facilitate the use of computing demanding applications in the field of NGS data analysis.</p>
<p>The docker4seq package uses <a href="https://www.docker.com/what-docker" class="external-link">docker</a> <a href="https://www.docker.com/what-container" class="external-link">containers</a> that embed demanding computing tasks, e.g. short reads mapping.</p>
<p>This approach provides multiple advantages:</p>
<ul><li><p>user does not need to install all the software on its local server</p></li>
<li><p>results generated by different containers can be organized in pipelines</p></li>
<li><p>reproducible research is guarantee by the possibility of sharing the docker containers used for the analysis</p></li>
</ul></div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a></h2>
<p>The minimal hardware requirements are a 4 core 64 bits linux computer, 32 Gb RAM, one SSD 250GB, with a folder with read/write permission for any users (chmod 777), and <a href="https://www.docker.com/" class="external-link">docker</a> installed.</p>
<p><a href="https://github.com/kendomaniac/docker4seq" class="external-link"><strong>docker4seq</strong></a> and its graphical interface <a href="https://github.com/mbeccuti/4SeqGUI" class="external-link"><strong>4SeqGUI</strong></a> can fit ideally in the <a href="https://www.intel.com/content/www/us/en/products/boards-kits/nuc/kits/nuc6i7kyk.html" class="external-link">NUC6I7KYK, Intel mini-computer</a> equipped with Kingston Technology HyperX Impact 32GB Kit (2x16GB), 2133MHz DDR4 CL13 260-Pin SODIMM and Samsung 850 EVO - 250GB - M.2 SATA III Internal SSD.</p>
<p><strong>MANDATORY:</strong> The first time <em>docker4seq</em> is installed the <strong>downloadContainers</strong> function needs to be executed to download in the local repository the docker containers that are needed by <em>docker4seq</em>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/downloadContainers.html">downloadContainers</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"docker"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dockers-containers">Dockers containers<a class="anchor" aria-label="anchor" href="#dockers-containers"></a></h2>
<p>At the present time all functions requiring some sort of calculation are embedded in the following docker containers:</p>
<ul><li><p>docker.io/rcaloger/annotate.2017.01 used by rnaseqCounts, rsemanno</p></li>
<li><p>docker.io/rcaloger/bwa.2017.01 used by bwaIndexUcsc, bwa</p></li>
<li><p>docker.io/rcaloger/chipseq.2017.01 used by chipseqCounts, chipseq</p></li>
<li><p>docker.io/rcaloger/r332.2017.01 used by experimentPower, sampleSize, wrapperDeseq2</p></li>
<li><p>docker.io/rcaloger/mirnaseq.2017.01 used by mirnaCounts</p></li>
<li><p>docker.io/rcaloger/rsemstar.2017.01 used by rnaseqCounts, rsemstarIndex, rsemstarUscsIndex</p></li>
<li><p>docker.io/rcaloger/skewer.2017.01 used by skewer</p></li>
</ul><div class="section level3">
<h3 id="docker-container-nomenclature">docker container nomenclature<a class="anchor" aria-label="anchor" href="#docker-container-nomenclature"></a></h3>
<p>In case of updates required to solve bugs, which do not affect the calculation docker.io/rcaloger/XXXXX.YYYY.ZZ the fiels ZZ will be updated.</p>
<p>In case of updates which affect the calculation, e.g. new release of Bioconductor libraries, the field YYYY will be updated. Previous versions will be maintained to allow reproducibility.</p>
</div>
<div class="section level3">
<h3 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a></h3>
<p>Within any folder generated with docker4seq functions it is saved the file <strong>containers.txt</strong>, which indicates the containers available in the local release of docker4seq.</p>
<p>In case, user would like to download a set of dockers containers different from those provided as part of the package those needs to be described in a file with the following format, <strong>docker.repository/user/docker.name</strong> which is passed to downloadContainers:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/downloadContainers.html">downloadContainers</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"docker"</span>, containers.file<span class="op">=</span><span class="st">"my_containers.txt"</span><span class="op">)</span></span>
<span><span class="co">#an example of the my_containers.txt file content</span></span>
<span><span class="va">docker.io</span><span class="op">/</span><span class="va">rcaloger</span><span class="op">/</span><span class="va">bwa.2017.01</span></span>
<span><span class="va">docker.io</span><span class="op">/</span><span class="va">rcaloger</span><span class="op">/</span><span class="va">chipseq.2017.01</span></span>
<span><span class="va">docker.io</span><span class="op">/</span><span class="va">rcaloger</span><span class="op">/</span><span class="va">r340.2017.01</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="available-workflows">Available workflows<a class="anchor" aria-label="anchor" href="#available-workflows"></a></h2>
<p>At the present time are available the following workflows:</p>
<ul><li>
<strong>mRNAseq</strong>, which allows:
<ul><li>adapter trimming with <a href="https://github.com/relipmoc/skewer" class="external-link">skewer</a>
</li>
<li>mapping with <a href="https://github.com/alexdobin/STAR" class="external-link">STAR</a>
</li>
<li>counting genes and isoforms with <a href="http://deweylab.github.io/RSEM/" class="external-link">RSEM</a>
</li>
<li>ENSEMBL gene annotation.</li>
<li>organizing the output of RSEM in tables to be used for differential expression analysis</li>
<li>visualizing experiment data with PCA</li>
<li>evaluating experiment power and sample size</li>
<li>detecting differentially expressed genes/isoforms</li>
</ul></li>
<li>
<strong>miRNAseq</strong>, which executes the workflow described in Cordero et al. PLoS One. 2012;7(2):e31630, embedding the following steps:
<ul><li>trimming adapters with <a href="http://cutadapt.readthedocs.io/en/stable/guide.html" class="external-link">cutadapt</a>
</li>
<li>miRNAs mapping on <a href="http://www.mirbase.org/" class="external-link">mirbase</a> hairpins using <a href="http://compbio.cs.toronto.edu/shrimp/" class="external-link">SHRiMP</a>
</li>
<li>quantification of mature miRNAs.</li>
<li>visualizing experiment data with PCA</li>
<li>evaluating experiment power and sample size</li>
<li>detecting differentially expressed miRNAs</li>
</ul></li>
<li>
<strong>ChIPseq</strong>, which allows:
<ul><li>adapter trimming with <a href="https://github.com/relipmoc/skewer" class="external-link">skewer</a>
</li>
<li>mapping with <a href="http://bio-bwa.sourceforge.net/bwa.shtml" class="external-link">BWA</a>
</li>
<li>peak calling using either MACS v 1.4 or SICER v 1.1</li>
<li>associating peaks to the nearest gene, UCSC annotation</li>
<li>full annotation of the nearest gene</li>
</ul></li>
</ul><p>The most computing expensive steps of the analyses are embedded in the following docker4seq functions: <strong>rnaseqCounts</strong>, <strong>mirnaCounts</strong>, <strong>chipseqCounts</strong>. These functions are also the only one that have RAM and computing power requirements not usually available in consumer computers. Below its shown the time required to run the above three functions increasing the number of sequenced reads.</p>
<div class="section level3">
<h3 id="rnaseqcounts-performances-on-different-hardware-configurations">rnaseqCounts performances on different hardware configurations<a class="anchor" aria-label="anchor" href="#rnaseqcounts-performances-on-different-hardware-configurations"></a></h3>
<p>The conversion between fastq files to counts is the most time consuming step in RNAseq data analysis and it normally requires high-end server. We tested <strong>rnaseqCounts</strong> on different hardware:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">+</span> SeqBox<span class="sc">:</span> NUC6I7KYK CPU i7<span class="sc">-</span>6770HQ <span class="fl">3.5</span> <span class="fu">GHz</span> (<span class="dv">1</span> core, <span class="dv">8</span> threads), <span class="dv">32</span> Gb RAM, HD <span class="dv">250</span> Gb SSD</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="sc">+</span> SGI UV200 server<span class="sc">:</span> CPU E5<span class="dv">-4650</span> v2 <span class="fl">2.40</span><span class="fu">GHz</span> (<span class="dv">8</span> cores, <span class="dv">160</span> threads), <span class="dv">1</span> Tb RAM, RAID <span class="dv">6</span>, <span class="dv">100</span> Tb SATA</span></code></pre></div>
<p>We run respctively 26, 52, 78, and 105 million reads increasing the number of threads till reaching the limit of the hardware or up to 64 threads, i.e. vaules shown in parenthesis in next figure. It is notable that SeqBox, mapping in 5 hours more than 100 milion reads, is able to handle can handle, in 20 hours, the throughput of the Illumina benchtop sequencer NextSeq 500, which produces up to 400 milion reads in a 30 hours run.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/mrna_performace.jpg" alt="rnaseqCounts overall performance"><div class="figcaption">rnaseqCounts overall performance</div>
</div>
</div>
<div class="section level3">
<h3 id="mirnacounts-performances-on-different-hardware-configurations">mirnaCounts performances on different hardware configurations<a class="anchor" aria-label="anchor" href="#mirnacounts-performances-on-different-hardware-configurations"></a></h3>
<p>We run resepctively 3, 6, 12, and 24 miRNA samples in parallel using <strong>mirnaCounts</strong>, increasing the number of threads till reaching the limit of the hardware or 24 threads, i.e. vaules shown in parenthesis in next figure.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/mirna_performace.jpg" alt="mirnaCounts overall performance"><div class="figcaption">mirnaCounts overall performance</div>
</div>
</div>
<div class="section level3">
<h3 id="chipseqcounts-performances-on-different-hardware-configurations">chipseqCounts performances on different hardware configurations<a class="anchor" aria-label="anchor" href="#chipseqcounts-performances-on-different-hardware-configurations"></a></h3>
<p>We run resepctively 37, 70, 111, and 149 million reads increasing the number of threads till reaching the limit of the hardware or up to 64 threads, i.e. vaules shown in parenthesis in next figure.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/chipseq_performance.jpg" alt="chipseqCounts overall performance"><div class="figcaption">chipseqCounts overall performance</div>
</div>
<p>From the point of view of parallelization the <strong>rnaseqCounts</strong> is the one that embeds the most parallelized tools: i) mapping with STAR and ii) quantifying transcripts with RSEM. Both these tools have a massive I/O requirement. On the basis of the results shown above parallelization does not improve very much the overall performaces, but compensate the poor I/O of the RAID based on SATA disk array. On the other side the presence of an SSD with very high I/O compensate in the limited amount of cores of SeqBox.</p>
<p>In the case of <strong>mirnaCounts</strong> and <strong>chipseqCounts</strong> the parallelization is very little and it is only available for the reads mapping procedure. On the otherside both functions have a massive I/O. The reduced parallelization of these two analyses combined with the higher I/O of the SSD with respect to the SATA array makes SeqBox extremely effective even with very high number of reads to be processed.</p>
</div>
</div>
<div class="section level2">
<h2 id="rnaseq-workflow-howto">RNAseq workflow: Howto<a class="anchor" aria-label="anchor" href="#rnaseq-workflow-howto"></a></h2>
<p>The mRNAseq workflow can be run using <strong>4SeqGUI</strong> graphical interface (linux/MAC):</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/rnaseq1.jpeg" alt="mRNAseq workflow"><div class="figcaption">mRNAseq workflow</div>
</div>
<p>Sample quantification is made of these steps:</p>
<ul><li><p>Creating a genome index for STAR (see end of this paragraph)</p></li>
<li><p>Running removing sequencing adapters</p></li>
<li><p>Mapping reads to the reference genome</p></li>
<li><p>Quantify gene and transcript expression level</p></li>
<li><p>Annotating genes.</p></li>
</ul><p>All the parameters can be setup using 4SeqGUI</p>
<div class="section level3">
<h3 id="creating-a-star-index-file-for-mrnaseq">Creating a STAR index file for mRNAseq:<a class="anchor" aria-label="anchor" href="#creating-a-star-index-file-for-mrnaseq"></a></h3>
<p>The index can be easily created using the graphical interface:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/rnaseq2.jpeg" alt="Creating a STAR genome index"><div class="figcaption">Creating a STAR genome index</div>
</div>
<p>A detailed description of the parameters is given below.</p>
<div class="section level4">
<h4 id="creating-a-star-index-file-by-line-command">Creating a STAR index file by line command<a class="anchor" aria-label="anchor" href="#creating-a-star-index-file-by-line-command"></a></h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/rsemstarIndex.html">rsemstarIndex</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"docker"</span>,genome.folder<span class="op">=</span><span class="st">"/data/scratch/hg38star"</span>,</span>
<span>ensembl.urlgenome<span class="op">=</span><span class="st">"ftp://ftp.ensembl.org/pub/release-87/fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna.toplevel.fa.gz"</span>,</span>
<span>ensembl.urlgtf<span class="op">=</span><span class="st">"ftp://ftp.ensembl.org/pub/release-87/gtf/homo_sapiens/Homo_sapiens.GRCh38.87.gtf.gz"</span><span class="op">)</span></span></code></pre></div>
<p>In brief, <strong>rsemstarIndex</strong> uses ENSEMBL genomic data. User has to provide the URL (<strong>ensembl.urlgenome</strong>) for the file XXXXX_dna.toplevel.fa.gz related to the organism of interest, the URL (<strong>ensembl.urlgtf</strong>) for the annotation GTF XXX.gtf.gz and the path to the folder where the index will be generated (<strong>genome.folder</strong>). The parameter <strong>threads</strong> indicate the number of cores dedicated to this task.</p>
</div>
</div>
<div class="section level3">
<h3 id="quantifying-genesisoforms">Quantifying genes/isoforms:<a class="anchor" aria-label="anchor" href="#quantifying-genesisoforms"></a></h3>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/rnaseq3.jpeg" alt="Gene, Isoform counting"><div class="figcaption">Gene, Isoform counting</div>
</div>
<p>A detailed description of the parameters is given below.</p>
<div class="section level4">
<h4 id="sample-quantification-by-line-command">Sample quantification by line command<a class="anchor" aria-label="anchor" href="#sample-quantification-by-line-command"></a></h4>
<p>The sample quantification can be also executed using R and it is completely embedded in a single function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget http://130.192.119.59/public/test.mrnaCounts.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.mrnaCounts.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"./test.mrnaCounts"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/rnaseqCounts.html">rnaseqCounts</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"docker"</span>,fastq.folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, scratch.folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>adapter5<span class="op">=</span><span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,</span>
<span>adapter3<span class="op">=</span><span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,</span>
<span>seq.type<span class="op">=</span><span class="st">"se"</span>, threads<span class="op">=</span><span class="fl">8</span>,  min.length<span class="op">=</span><span class="fl">40</span>,</span>
<span>genome.folder<span class="op">=</span><span class="st">"/data/scratch/mm10star"</span>, strandness<span class="op">=</span><span class="st">"none"</span>, save.bam<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>org<span class="op">=</span><span class="st">"mm10"</span>, annotation.type<span class="op">=</span><span class="st">"gtfENSEMBL"</span><span class="op">)</span></span></code></pre></div>
<p>User needs to create the <strong>fastq.folder</strong>, where the fastq.gz file(s) for the sample under analysis are located. The <strong>scratch.folder</strong> is the location where temporary data are created. The results will be then saved in the <strong>fastq.folder</strong>.</p>
<p>User needs to provide also the sequence of the sequencing adapters, <strong>adapter5</strong> and <strong>adapter3</strong> parameters. In case Illumina platform is used the adapters sequences can be easily recovered <a href="https://support.illumina.com/content/dam/illumina-support/documents/documentation/chemistry_documentation/experiment-design/illumina-adapter-sequences_1000000002694-01.pdf" class="external-link"><strong>here</strong></a>.</p>
<p><strong>seq.type</strong> indicates if single end (se) or pair-end (pe) data are provided, <strong>threads</strong> indicates the max number of cores used by <em>skewer</em> and <em>STAR</em>, all the other steps are done on a single core.</p>
<p>The <strong>min.length</strong> refers to the minimal length that a reads should have after adapters trimming. Since today the average read length for a RNAseq experiment is 50 or 75 nts would be better to bring to 40 nts the min.length parameter to increase the precision in assigning the correct position on the genome.</p>
<p>The <strong>genome.folder</strong> parameter refers to the location of the genomic index generated by STAR using the <em>docker4seq</em> function <strong>rsemstarIndex</strong>. The generation of the genome index is very simple and it is highlited at the end of this paragraph.</p>
<p><strong>strandness</strong>, is a parameter referring to the kit used for the library prep. If the kit does not provide strand information it is set to “none”, if provides strand information is set to “forward” for Illumina stranded kit and it set to “reverse” for Illumina ACCESS kit. <strong>save.bam</strong> set to TRUE indicates that genomic bam file and transcriotomic bam files are also saved at the end of the analysis. <strong>annotation.type</strong> refers to the type of available gene-level annotation. At the present time is only available ENSEMBL annotation defined by the gtf downloaded during the creation of the indexed genome files, see paragraph <em>at the end</em>Creating a STAR index file for mRNAseq*.</p>
</div>
</div>
<div class="section level3">
<h3 id="sample-quantification-output-files">Sample quantification output files<a class="anchor" aria-label="anchor" href="#sample-quantification-output-files"></a></h3>
<p>The mRNAseq workflow produces the following output files:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="sc">+</span> XXXXX<span class="sc">-</span>trimmed.log, containing the information related to the adapters trimming</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="sc">+</span> gtf_annotated_genes.results, the output of RSEM gene quantification with gene<span class="sc">-</span>level annotation</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="sc">+</span> Log.final.out, the statistics of the genome mapping generated by STAR  </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="sc">+</span> rsem.info, summary of the parameters used <span class="cf">in</span> the run</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="sc">+</span> genes.results, the output of RSEM gene quantification</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="sc">+</span> isoforms.results, the output of RSEM isoform quantification</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="sc">+</span> run.info, some statistics on the run</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="sc">+</span> skewerd_xxxxxxxxxxxx.log, log of the skewer docker container</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="sc">+</span> stard.yyyyyyyyyyyy.log, log of the star docker container</span></code></pre></div>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/rnaseq7.jpeg" alt="gtf_annotated_genes.results"><div class="figcaption">gtf_annotated_genes.results</div>
</div>
<p>The first column in <strong>gtf_annotated_genes.results</strong> is the ensembl gene id, the second is the <a href="http://www.ensembl.org/Help/Faq?id=468" class="external-link">biotype</a>, the 3rd is the annotation source, the 4th contains the set of transcripts included in the ensembl gene id. Then there is the length of the gene, the lenght of the gene to which is subtracted the average length of the sequenced fragments, the expected counts are the couts to be used for differentiual expression analysis. <a href="https://haroldpimentel.wordpress.com/2014/05/08/what-the-fpkm-a-review-rna-seq-expression-units/" class="external-link">TPM</a> and <a href="https://haroldpimentel.wordpress.com/2014/05/08/what-the-fpkm-a-review-rna-seq-expression-units/" class="external-link">FPM</a> are normalized gene quantities to be used only for visualization purposes.</p>
</div>
<div class="section level3">
<h3 id="from-samples-to-experiment">From samples to experiment<a class="anchor" aria-label="anchor" href="#from-samples-to-experiment"></a></h3>
<p>The RSEM output is sample specific, thus it is necessary to assemble the single sample in an experiment table including in the header of the column both the covariates and the batch, if any. The header sample name is separated by the covariate with an underscore, e.g. mysample1_Cov1, mysample2_Cov2.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/counts1.jpeg" alt="counts table with covariates"><div class="figcaption">counts table with covariates</div>
</div>
<p>In case also a batch is present also this is separated by a further underscore, e.g. mysample1_Cov1_batch1, mysample2_Cov_batch2.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/counts2.jpeg" alt="counts table with covariates and batch"><div class="figcaption">counts table with covariates and batch</div>
</div>
<p>The addition of the covariates to the various samples can be done using the <strong>4seqGUI</strong> using the button: <em>From samples to experiment</em>. Covariates are added to the column name, i.e. sample name, using _, e.g. mysample_Cov.1. Batches are added after covariates with _, e.g. mysample_Cov.1_batch.1.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/counts3.jpeg" alt="generating a table with covariates"><div class="figcaption">generating a table with covariates</div>
</div>
<div class="section level4">
<h4 id="from-samples-to-experiments-by-line-command">From samples to experiments by line command<a class="anchor" aria-label="anchor" href="#from-samples-to-experiments-by-line-command"></a></h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget http://130.192.119.59/public/test.samples2experiment.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.samples2experiment.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.samples2experiment"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/sample2experiment.html">sample2experiment</a></span><span class="op">(</span>sample.folders<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"./e1g"</span>,<span class="st">"./e2g"</span>,<span class="st">"./e3g"</span>,</span>
<span><span class="st">"./p1g"</span>, <span class="st">"./p2g"</span>, <span class="st">"./p3g"</span><span class="op">)</span>,</span>
<span>covariates<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cov.1"</span>,<span class="st">"Cov.1"</span>,<span class="st">"Cov.1"</span>,<span class="st">"Cov.2"</span>,<span class="st">"Cov.2"</span>,<span class="st">"Cov.2"</span><span class="op">)</span>,</span>
<span>bio.type<span class="op">=</span><span class="st">"protein_coding"</span>, output.prefix<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<p>User needs to provide the paths of the samples, <strong>sample.folder</strong> parameter, a vector of the covariates, <strong>covariates</strong>, and the biotype(s) of interest, <strong>bio.type</strong> parameter. The parameter <strong>output.prefix</strong> refers to the path where the output will be created, as default this is the actual R working folder.</p>
</div>
<div class="section level4">
<h4 id="from-samples-to-experiments-output-files">From samples to experiments output files<a class="anchor" aria-label="anchor" href="#from-samples-to-experiments-output-files"></a></h4>
<p>The samples to experiments produces the following output files:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">+</span> _counts.txt<span class="sc">:</span> gene<span class="sc">-</span>level raw counts table <span class="cf">for</span> differential expression analysis</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="sc">+</span> _isoforms_counts.txt<span class="sc">:</span> isoform<span class="sc">-</span>level raw counts table <span class="cf">for</span> differential expression analysis</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="sc">+</span> _isoforms_log2TPM.txt<span class="sc">:</span> isoform<span class="sc">-</span>level log2TPM <span class="cf">for</span> visualization purposes</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="sc">+</span> _log2TPM.txt<span class="sc">:</span> gene<span class="sc">-</span>level log2TPM <span class="cf">for</span> visualization purposes</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="sc">+</span> _isoforms_log2FPKM.txt<span class="sc">:</span> isoform<span class="sc">-</span>level log2FPKM <span class="cf">for</span> visualization purposes</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="sc">+</span> _log2FPKM.txt<span class="sc">:</span> gene<span class="sc">-</span>level log2FPKM <span class="cf">for</span> visualization purposes</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="sc">+</span> XXXXX.Rout<span class="sc">:</span> logs of the execution</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualizing-experiment-data-with-pca">Visualizing experiment data with PCA<a class="anchor" aria-label="anchor" href="#visualizing-experiment-data-with-pca"></a></h3>
<p><a href="https://georgemdallas.wordpress.com/2013/10/30/principal-component-analysis-4-dummies-eigenvectors-eigenvalues-and-dimension-reduction/" class="external-link">PCA</a> finds the principal components of data. Principal components are the underlying structure in the data. They are the directions where there is the most variance, the directions where the data is most spread out. <strong>4SeqGUI</strong> provides an interface to the generation experiment samples PCA</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/pca1.jpeg" alt="PCA"><div class="figcaption">PCA</div>
</div>
<p>The plot is saved in <strong>pca.pdf</strong> in the selected folder.</p>
<div class="section level4">
<h4 id="pca-by-line-command">PCA by line command<a class="anchor" aria-label="anchor" href="#pca-by-line-command"></a></h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.analysis"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/pca.html">pca</a></span><span class="op">(</span>experiment.table<span class="op">=</span><span class="st">"_log2FPKM.txt"</span>, type<span class="op">=</span><span class="st">"FPKM"</span>, legend.position<span class="op">=</span><span class="st">"topleft"</span>, covariatesInNames<span class="op">=</span><span class="cn">FALSE</span>, principal.components<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, pdf <span class="op">=</span> <span class="cn">TRUE</span>, output.folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>User needs to provide the paths of experiment table, <strong>experiment.table</strong> parameter, i.e. the file generated using the samples2experiment function. The <strong>type</strong> parameter indicates if FPKM, TPM or counts are used for the PCA geenration. The parameter <strong>legend.position</strong> defines where to locate the covariates legend. The parameter <strong>covariatesInNames</strong> indicates if the header of the experiment table contains or not covariate information. The parameter <strong>principal.components</strong> indicates which principal components should be plotted. <strong>output.folder</strong> indicates where to save the pca.pdf file.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/pca2.jpeg" alt="pca.pdf"><div class="figcaption">pca.pdf</div>
</div>
<p>The values in parentesis on x and y axes are the amount of variance explained by each principal component.</p>
<p>IMPORTANT: The above analysis is suitable also for miRNAseq data</p>
</div>
</div>
<div class="section level3">
<h3 id="evaluating-experiment-power-and-sample-size">Evaluating experiment power and sample size<a class="anchor" aria-label="anchor" href="#evaluating-experiment-power-and-sample-size"></a></h3>
<p><a href="https://www.ncbi.nlm.nih.gov/pubmed/25246651" class="external-link">RnaSeqSampleSize</a> Bioconductor package provides the possibility to calculate, from a pilot experiment, the statistical power and to define the optimal sample size. <strong>4SeqGUI</strong> provides an interface to sample size estimation:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/ss.jpeg" alt="sample size estimation"><div class="figcaption">sample size estimation</div>
</div>
<p>and to statistical power estimation:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/es.jpeg" alt="stat power estimation"><div class="figcaption">stat power estimation</div>
</div>
<div class="section level4">
<h4 id="sample-size-estimation-by-line-command">Sample size estimation by line command<a class="anchor" aria-label="anchor" href="#sample-size-estimation-by-line-command"></a></h4>
<p>Sample size estimation is an important issue in the design of RNA sequencing experiments. We have implemented a wrapper function for sample size estimation using the bioconductor package RnaSeqSampleSize.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.analysis"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/sampleSize.html">sampleSize</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"docker"</span>, filename<span class="op">=</span><span class="st">"_counts.txt"</span>, power<span class="op">=</span><span class="fl">0.80</span>, FDR<span class="op">=</span><span class="fl">0.1</span>, genes4dispersion<span class="op">=</span><span class="fl">200</span>, log2fold.change<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The requested parameters are the path to the counts experiment table generated by <strong>samples2experiment</strong> function. The param <strong>power</strong> indicates the expecte fraction of differentially expressed gene, e.g 0.80. <strong>FDR</strong> and <strong>log2fold.change</strong> are the two thresholds used to define the set of differentially expressed genes of interest.</p>
<p>The output file is <strong>sample_size_evaluation.txt</strong> is saved in the R working folder, below an example of the file content:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/samplesize1.jpeg" alt="sample_size_evaluation.txt"><div class="figcaption">sample_size_evaluation.txt</div>
</div>
<p>IMPORTANT: The above analysis is suitable also for miRNAseq data</p>
</div>
<div class="section level4">
<h4 id="experiment-statistical-power-estimation-by-line-command">Experiment statistical power estimation by line command<a class="anchor" aria-label="anchor" href="#experiment-statistical-power-estimation-by-line-command"></a></h4>
<p>Experiment power provides an indication of which is the fraction of differentially expressed genes that can be detected given a specific number of samples and differential expression detection thresholds. We have implemented a wrapper function for experiment power estimation using the bioconductor package RnaSeqSampleSize.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.analysis"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/experimentPower.html">experimentPower</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"docker"</span>, filename<span class="op">=</span><span class="st">"_counts.txt"</span>,replicatesXgroup<span class="op">=</span><span class="fl">7</span>, FDR<span class="op">=</span><span class="fl">0.1</span>, genes4dispersion<span class="op">=</span><span class="fl">200</span>, log2fold.change<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The requested parameters are the path to the counts experiment table generated by <strong>samples2experiment</strong> function. The param <strong>replicatesXgroup</strong> indicates the number of sample associated to each of the two covariates. <strong>FDR</strong> and <strong>log2fold.change</strong> are the two thresholds used to define the set of differentially expressed genes of interest. <strong>genes4dispersion</strong> indicates the number of genes used in estimation of read counts and dispersion distribution.</p>
<p>The output file is <strong>power_estimation.txt</strong> is saved in the R working folder, below an example of the file content:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/expp1.jpeg" alt="power_estimation.txt"><div class="figcaption">power_estimation.txt</div>
</div>
<p>IMPORTANT: The above analysis is suitable also for miRNAseq data</p>
</div>
</div>
<div class="section level3">
<h3 id="differential-expression-analysis-with-deseq2">Differential expression analysis with DESeq2<a class="anchor" aria-label="anchor" href="#differential-expression-analysis-with-deseq2"></a></h3>
<p>A basic task in the analysis of count data from RNA-seq is the detection of differentially expressed genes. <strong>4SeqGUI</strong> provides an interface to DESeq2 to simplify differential expression analysis.</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/de1.jpeg" alt="DESeq2"><div class="figcaption">DESeq2</div>
</div>
<p>The output files are:</p>
<p><strong>DEfull.txt</strong> containing the full set of results generated by DESeq2</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/de2.jpeg" alt="DEfull.txt"><div class="figcaption">DEfull.txt</div>
</div>
<p><strong>DEfiltered_log2fc_X_fdr_Y.Y.txt</strong> containing the set of differentially expressed genes passing the indicated thresholds</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/de3.jpeg" alt="DEfiltered_log2fc_1_fdr_0.1.txt"><div class="figcaption">DEfiltered_log2fc_1_fdr_0.1.txt</div>
</div>
<p><strong>genes4david.txt</strong> a file containing only the gene symbols to be used as input for <a href="https://david.ncifcrf.gov/" class="external-link">DAVID</a> or <a href="http://amp.pharm.mssm.edu/Enrichr/" class="external-link">ENRICHR</a></p>
<p>log2normalized_counts.txt, DESeq2 log2 library size normalized counts to be used for visualizaiton only instead of log2 FPKM or log2 TPM.</p>
<div class="section level4">
<h4 id="deseq2-by-line-command">DESeq2 by line command<a class="anchor" aria-label="anchor" href="#deseq2-by-line-command"></a></h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.analysis"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/wrapperDeseq2.html">wrapperDeseq2</a></span><span class="op">(</span>output.folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, group<span class="op">=</span><span class="st">"docker"</span>, experiment.table<span class="op">=</span><span class="st">"_counts.txt"</span>, log2fc<span class="op">=</span><span class="fl">1</span>, fdr<span class="op">=</span><span class="fl">0.1</span>, ref.covar<span class="op">=</span><span class="st">"Cov.1"</span>, type<span class="op">=</span><span class="st">"gene"</span>, batch<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>User needs to provide experiment table, <strong>experiment.table</strong> param, i.e. the counts table generated with <strong>samples2experiment</strong> function, the thresholds for the differential expression analysis, <strong>log2fc</strong> and <strong>fdr</strong> params, the reference covariate, <strong>ref.covar</strong> param, i.e. the covariate that is used as reference for differential expression detection, the <strong>type</strong> param, whihc refers to the type of experiment table in use: <em>gene</em>, <em>isoform</em>, <em>mirna</em>, <strong>batch</strong> parameter that indicates, it it is set to <strong>TRUE</strong> that the header of the experiment table also contains the extra information for the batch effect (see above).</p>
<p>IMPORTANT: the above analysis can be also applied to miRNAseq data.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="mirnaseq-workflow">miRNAseq workflow<a class="anchor" aria-label="anchor" href="#mirnaseq-workflow"></a></h2>
<p>The miRNAseq workflow can be run using <strong>4SeqGUI</strong> graphical interface:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/mirna1.jpeg" alt="miRNAseq workflow"><div class="figcaption">miRNAseq workflow</div>
</div>
<p>The miRNAseq docker container executes the following steps:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/mirna3.jpeg" alt="miRNAseq workflow"><div class="figcaption">miRNAseq workflow</div>
</div>
<p>The full workflow is described in <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0031630" class="external-link">Cordero et al. Plos ONE 2012</a>. In brief, fastq files are trimmed using <a href="https://github.com/marcelm/cutadapt" class="external-link">cutadapt</a> and the trimmed reads are mapped on miRNA precursors, i.e. harpin.fa file, from <a href="http://www.mirbase.org/ftp.shtml" class="external-link">miRBase</a> using <a href="http://compbio.cs.toronto.edu/shrimp/" class="external-link">SHRIMP</a>. Using the location of the mature miRNAs in the precursor, countOverlaps function, from the Bioconductor package GenomicRanges is used to quantify the reads mapping on mature miRNAs.</p>
<p>All the parameters needed to run the miRNAseq workflow can be setup using 4SeqGUI</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/mirna2.jpeg" alt="miRNAseq parameters"><div class="figcaption">miRNAseq parameters</div>
</div>
<p>A detailed description of the parameters is given below.</p>
<div class="section level3">
<h3 id="mirnaseq-workflow-by-line-command">miRNAseq workflow by line command<a class="anchor" aria-label="anchor" href="#mirnaseq-workflow-by-line-command"></a></h3>
<p>The miRNAseq workflow can be also executed using R and it is completely embedded in a unique function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget 130.192.119.59/public/test.mirnaCounts.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.mirnaCounts.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.mirnaCounts"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/mirnaCounts.html">mirnaCounts</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"docker"</span>,fastq.folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, scratch.folder<span class="op">=</span><span class="st">"/data/scratch"</span>, </span>
<span>            mirbase.id<span class="op">=</span><span class="st">"hsa"</span>,download.status<span class="op">=</span><span class="cn">FALSE</span>, adapter.type<span class="op">=</span><span class="st">"NEB"</span>, trimmed.fastq<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>User needs to create the <strong>fastq.folder</strong>, where the fastq.gz files for all miRNAs under analysis are located. The <strong>scratch.folder</strong> is the location where temporary data are created. The results will be then saved in the <strong>fastq.folder</strong>. User needs to provide also the identifier of the miRBase organism, e.g. <strong>hsa</strong> for Homo sapiens, <strong>mmu</strong> for Mus musculus. If the <strong>download.status</strong> is set to FALSE, mirnaCounts uses miRBase release 21, if it is set to TRUE the lastest version of precursor and mature miRNAs will be downloaded from miRBase. Users need to provide the name of the producer of the miRNA library prep kit to identify which adapters need to be provided to cutadapt, <strong>adapter.type</strong> parameter. The available adapters are NEB and Illumina, but, upon request, we can add other adapters. Finally, if the <strong>trimmed.fastq</strong> is set to FALSE the trimmed fastq are not saved at the end of the analysis.</p>
</div>
<div class="section level3">
<h3 id="mirnaseq-workflow-output-files">miRNAseq workflow output files<a class="anchor" aria-label="anchor" href="#mirnaseq-workflow-output-files"></a></h3>
<p>The miRNAseq workflow produces the following output files:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="sc">+</span> README<span class="sc">:</span> A file describing the content of the data folder</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="sc">+</span> all.counts.txt<span class="sc">:</span> miRNAs raw counts, to be used <span class="cf">for</span> differential expression analysis</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="sc">+</span> trimmimg.log<span class="sc">:</span> adapters trimming statistics</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="sc">+</span> shrimp.log<span class="sc">:</span> mapping statistics</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="sc">+</span> all.counts.Rda<span class="sc">:</span> miRNAs raw counts ready to be loaded <span class="cf">in</span> R.</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="sc">+</span> analysis.log<span class="sc">:</span> logs of the full analysis pipeline</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adding-covariates-and-batches-to-mirnacounts-output-allcountstxt">Adding covariates and batches to mirnaCounts output: all.counts.txt<a class="anchor" aria-label="anchor" href="#adding-covariates-and-batches-to-mirnacounts-output-allcountstxt"></a></h2>
<p>The funnction <strong>mirnaCovar</strong> add to the header of all.counts.txt covariates and batches or covariates only.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#test example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget 130.192.119.59/public/test.mirna.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.mirna.analysis.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.mirna.analysis"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/mirnaCovar.html">mirnaCovar</a></span><span class="op">(</span>experiment.folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>     covariates<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, </span>
<span>                  <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span><span class="op">)</span>,</span>
<span>     batches<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bath.1"</span>, <span class="st">"bath.1"</span>, <span class="st">"bath.2"</span>, <span class="st">"bath.2"</span>, <span class="st">"batch.1"</span>, <span class="st">"batch.1"</span>, </span>
<span>               <span class="st">"batch.2"</span>, <span class="st">"batch.2"</span>,<span class="st">"batch.1"</span>, <span class="st">"batch.1"</span>,<span class="st">"bath.2"</span>, <span class="st">"bath.2"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="chipseq-workflow">chipseq workflow<a class="anchor" aria-label="anchor" href="#chipseq-workflow"></a></h2>
<p>The chipseq workflow can be run using <strong>4SeqGUI</strong> graphical interface:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/chipseq0.jpeg" alt="ChIPseq workflow"><div class="figcaption">ChIPseq workflow</div>
</div>
<p>The ChIPseq is made of two main steps:</p>
<ul><li><p>Creating a genome index for BWA (see end of this paragraph)</p></li>
<li><p>Running MACS or SICER analysis</p></li>
</ul><div class="section level3">
<h3 id="creating-a-bwa-index-file-for-chipseq">Creating a BWA index file for Chipseq:<a class="anchor" aria-label="anchor" href="#creating-a-bwa-index-file-for-chipseq"></a></h3>
<p>The index can be easily created using the graphical interface:</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/chipseq1.jpeg" alt="Creating a BWA index with Genome indexing BWA"><div class="figcaption">Creating a BWA index with Genome indexing BWA</div>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/bwaIndexUcsc.html">bwaIndexUcsc</a></span><span class="op">(</span>group<span class="op">=</span><span class="st">"sudo"</span>,genome.folder<span class="op">=</span><span class="st">"/sto2/data/scratch/mm10bwa"</span>, uscs.urlgenome<span class="op">=</span></span>
<span><span class="st">"http://hgdownload.cse.ucsc.edu/goldenPath/mm10/bigZips/chromFa.tar.gz"</span>,</span>
<span>gatk<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In brief, <strong>bwaIndexUcsc</strong> uses UCSC genomic data. User has to provide the URL (<strong>uscs.urlgenome</strong>) for the file chromFa.tar.gz related to the organism of interest and the path to the folder where the index will be generated (<strong>genome.folder</strong>). The parameter <strong>gatk</strong> has to be set to FALSE because is not used for a genomic index used for ChIPseq.</p>
</div>
<div class="section level3">
<h3 id="calling-peaks-and-annotating">Calling peaks and annotating:<a class="anchor" aria-label="anchor" href="#calling-peaks-and-annotating"></a></h3>
<p>All the parameters needed to run MACS or SICER can be setup using 4SeqGUI</p>
<div class="float">
<img src="/Users/raffaelecalogero/Dropbox/data/docker/stable/docker4seq/inst/img/chipseq3.jpeg" alt="MACS and SICER analysis"><div class="figcaption">MACS and SICER analysis</div>
</div>
<p>A detailed description of the parameters is given below.</p>
</div>
<div class="section level3">
<h3 id="chipseq-workflow-by-line-command">Chipseq workflow by line command<a class="anchor" aria-label="anchor" href="#chipseq-workflow-by-line-command"></a></h3>
<p>The chipseq workflow can be also executed using R and it is completely embedded in a unique function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"wget 130.192.119.59/public/test.chipseqCounts.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"test.chipseqCounts.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"test.chipseqCounts"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">docker4seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/chipseqCounts.html">chipseqCounts</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"docker"</span>, output.folder <span class="op">=</span> <span class="st">"./prdm51.igg"</span>,</span>
<span>  mock.folder<span class="op">=</span><span class="st">"./igg"</span>, test.folder<span class="op">=</span><span class="st">"./prdm51"</span>, scratch.folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  adapter5 <span class="op">=</span> <span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,</span>
<span>  adapter3 <span class="op">=</span> <span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">8</span>, min.length <span class="op">=</span> <span class="fl">30</span>, <span class="va">genome.folder</span>,</span>
<span>  mock.id <span class="op">=</span> <span class="st">"igg"</span>, test.id <span class="op">=</span> <span class="st">"tf"</span>, <span class="va">genome</span>, read.size <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  tool <span class="op">=</span> <span class="st">"macs"</span>, macs.min.mfold <span class="op">=</span> <span class="fl">10</span>, macs.max.mfold <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  macs.pval <span class="op">=</span> <span class="st">"1e-5"</span>, sicer.wsize <span class="op">=</span> <span class="fl">200</span>, sicer.gsize <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  sicer.fdr <span class="op">=</span> <span class="fl">0.1</span>, tss.distance <span class="op">=</span> <span class="fl">0</span>, max.upstream.distance <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  remove.duplicates <span class="op">=</span> <span class="st">"N"</span><span class="op">)</span></span></code></pre></div>
<p>Specifically user needs to create three folders:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="sc">+</span> mock.folder, where the fastq.gz file <span class="cf">for</span> the control sample is located. For control sample we refer to ChIP with IgG only or input DNA.</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="sc">+</span> test.folder, where the fastq.gz file <span class="cf">for</span> the ChIP of the sample to be analysed.</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="sc">+</span> output.folder, where the R script embedding the above script is located.</span></code></pre></div>
<p>The <strong>scratch.folder</strong> can be the same as the <strong>output.folder</strong>. However, if the system in use has a high speed disk for temporary calculation, e.g. a SSD disk, the location of the scratch.folder on the SSD will reduce significantly the computing time.</p>
<p>User needs to provide also the sequence of the sequencing adapters, <strong>adapter5</strong> and <strong>adapter3</strong> parameters. In case Illumina platform is used the adapters sequences can be easily recovered <a href="https://support.illumina.com/content/dam/illumina-support/documents/documentation/chemistry_documentation/experiment-design/illumina-adapter-sequences_1000000002694-01.pdf" class="external-link">here</a>.</p>
<p><strong>Threads</strong> indicates the max number of cores used by <em>skewer</em> and <em>bwa</em>, all the other steps are done on a single core. The <strong>min.length</strong> refers to the minimal length that a reads should have after adapters trimming. Since today the average read length for a ChIP experiment is 50 or 75 nts would be better to bring to 40 nts the min.length parameter to increase the precision in assigning the correct position on the genome.</p>
<p>The <strong>genome.folder</strong> parameter refers to the location of the genomic index generated by bwa using the <em>docker4seq</em> function <strong>bwaIndexUcsc</strong>. The generation of the genome index for ChIP experiment is very simple and it is highlited at the end of this paragraph.</p>
<p><strong>mock.id</strong> and <strong>test.id</strong> identify the type of sample and are assigned to the ID parameter in the RG field of the bam file.</p>
<p><strong>genome</strong> is the parameter referring to the annotation used to associate ChIP peaks to genes. In the present implemetation are available hg38, hg19 for human and mm10 and mm9 for mouse annotations.</p>
<p><strong>read.size</strong> is a parameter requested by MACS and SICER for their analysis. <strong>macs.min.mfold</strong>, <strong>macs.max.mfold</strong>, <strong>macs.pval</strong> are the deafult parameters requested for peaks definition for more info please refer to the documetation of MACS 1.4. <strong>sicer.wsize</strong>, <strong>sicer.gsize</strong>, <strong>sicer.fdr</strong> are the deafult parameters requested for peaks definition for more info please refer to the documetation ofSICER 1.1. <strong>Important</strong>: The optimal value for <strong>sicer.gsize</strong> in case of H3K4Me3 ChIP is 200 and in case of ChIP H3K27Me3 is 600.</p>
<p><strong>tss.distance</strong> and <strong>max.upstream.distance</strong> are parameters required by ChIPseqAnno, which is the bioconducto package used to assign the peaks to specific genes. Specifically max.upstream.distance refers to the max distance in nts that allow to associate a peak to a gene.</p>
<p><strong>remove.duplicates</strong> is the parameter that indicates if duplicates need to be removed or not. It has two options: <strong>N</strong> duplicates are not removed, <strong>Y</strong> duplicates are removed.</p>
</div>
<div class="section level3">
<h3 id="chipseq-workflow-output-files">Chipseq workflow output files<a class="anchor" aria-label="anchor" href="#chipseq-workflow-output-files"></a></h3>
<p>The chipseq workflow produces the following output files:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="sc">+</span> README<span class="sc">:</span> A file describing the content of the data folder</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="sc">+</span> mypeaks.xls<span class="sc">:</span> All detected peaks alongside the nearest gene and its annotation</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="sc">+</span> mytreat.counts<span class="sc">:</span> The total reads count <span class="cf">for</span> the provided treatment file</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="sc">+</span> mycontrol.counts<span class="sc">:</span> The total reads count <span class="cf">for</span> the provided control<span class="sc">/</span>background file</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="sc">+</span> peak_report.xls<span class="sc">:</span> Aggregate information regarding the peak and their position relative to the nearest gene</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="sc">+</span> chromosome_distribution.pdf<span class="sc">:</span> Barplot of the distribution of the peaks on the chromosomes</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="sc">+</span> relative_position_distribution.pdf<span class="sc">:</span> Barplot of the distribution of the peaks positions relative to their nearest gene</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="sc">+</span> peak_width_distribution.pdf<span class="sc">:</span> Histogram of the distribution of the width of the peaks</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="sc">+</span> distance_from_nearest_gene_distribution.pdf<span class="sc">:</span> Histogram of the distribution of the distance of each peak from its nearest gene</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="sc">+</span> cumulative_coverage_total.pdf<span class="sc">:</span> Cumulative normalized gene coverage</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="sc">+</span> cumulative_coverage_chrN.pdf<span class="sc">:</span> Cumulative normalized gene coverage <span class="cf">for</span> the specific chromosome</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="sc">+</span> mycontrol_sorted.bw<span class="sc">:</span> bigWig file <span class="cf">for</span> UCSC Genome Browser visualization</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="sc">+</span> mytreat_sorted.bw<span class="sc">:</span> bigWig file <span class="cf">for</span> UCSC Genome Browser visualization</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a> </span></code></pre></div>
</div>
</div>


  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by Raffaele Calogero, Neha Kulkarni, Luca Alessandri, Marco Beccuti, Greta Romano, Francesca Cordero.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

